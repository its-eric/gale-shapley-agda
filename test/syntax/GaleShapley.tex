\newcommand{\GaleShapley}{%

To define the Gale-Shapley algorithm in Agda, we need a data structure which captures the state of the procedure in its various elements, in order to reason about its properties in an expressive enough manner that proofs can be written in the same manner as we have reasoned logically about the properties of the algorithm in chapter \ref{Chapter3}. We make use here of Agda's record types in the following manner:
In Agda syntax, a $record$ defines a type that groups some values, in our case, the details of the group of men and women and their preference lists for the "matching ritual". Men are preference lists indexed over a representative natural number as well as women, giving a similar "state space" to the problem as the one defined in the previous mathematical specification. This type can be constructed with the $mkState$ keyword, and its elements are accessible at all times through (pattern matching and) projection functions defined automatically by Agda as such:

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{GaleShapley}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Agda.Builtin.String}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Agda.Builtin.Equality}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Empty}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Maybe}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat.Properties}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Bool}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.List}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Sum}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Induction.WellFounded}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Binary.PropositionalEquality}\<%
\\
\>[0]\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat.Solver}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Data.Nat.Solver.+-*-Solver}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{prove}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{solve}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}:=\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{var}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}:+\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}:*\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{:-\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}:-\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- lem2 : (4 + 6 ≡ 10)}\<%
\\
\>[0]\AgdaComment{-- lem2 = solve 0 (con 4 :+ con 6 := con 10) refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{lem3}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{*}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaNumber{8}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{*}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lem3}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{solve}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x'}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:*}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{8}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:*}}\AgdaSpace{}%
\AgdaBound{x'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\<%
\\
\>[0]\AgdaKeyword{infix}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}>just\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infix}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaNumber{0}\<%
\\
\>[0]\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{xs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{xs}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{compSumPrefLists}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaFunction{compSumPrefLists}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{MatchingState}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\<%
\\
%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{men}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaField{freeMen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaField{engagedMen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaField{women}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaField{couples}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaField{sumPrefLists}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
%
\>[4]\AgdaField{sumEq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{sumPrefLists}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\<%
\\
\>[0]\<%
\end{code}

We expect to start the execution of the algorithm with a copy of all men in the $freeMen$ list, and finish with all of them in $engagedMen$. A list of couples can then be extracted from $couples$. The lists $men$ and $women$ are preserved throughout the execution; the reason behind this particular design decision is to facilitate the writing of predicates in Agda, since, as introduced before, proofs involving the Gale-Shapley algorithm may discuss at the same time the "absolute" preference list of men and women or the \emph{current state} of their preference lists at a certain step of the algorithm. Therefore the current state of a certain man's preference list can be observed either in this or that list given that the man is free or engaged at a certain point during the execution.

Some helper functions are defined as tools to support the algorithm. They are defined always over pattern matching, typed with the help of Agda's case expansions:

\begin{code}%
\>[0]\AgdaComment{-- Code by @yeputons on Stack Overflow :D}\<%
\\
\>[0]\AgdaFunction{is-≤}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Bool}\<%
\\
\>[0]\AgdaFunction{is-≤}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≤′?}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{Dec.yes}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{true}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{Dec.no}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{false}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Helper function to search for an element in a list of natural numbers.}\<%
\\
\>[0]\AgdaFunction{positionInListHelper}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaComment{--searched everywhere but couldn't find it!}\<%
\\
\>[0]\AgdaFunction{positionInListHelper}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{positionInListHelper}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{xs}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{xss}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{xs}\<%
\\
\>[0]\AgdaComment{--found man at the tip of the list!}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[15]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaComment{--accumulate and keep searching...}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[15]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{positionInListHelper}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{xss}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{positionInListHelper}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{xs}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{xss}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{xs}\<%
\\
\>[0]\AgdaComment{--found man somewhere in the list}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[15]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaComment{--accumulate and keep searching}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[15]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{positionInListHelper}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{xss}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{positionInList}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaFunction{positionInList}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{ns}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{positionInListHelper}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{ns}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\<%
\\
\>[0]\<%
\end{code}

Three main "operations" are performed during the execution of the algorithm which deserve special attention. In the beginning of the \emph{proposal} step a woman receives a proposal over which she mulls:

\begin{code}%
\>[0]\AgdaComment{-- m is the proposing man}\<%
\\
\>[0]\AgdaComment{-- h is the current husband of the woman}\<%
\\
\>[0]\AgdaComment{-- prefs is the preference list of the woman}\<%
\\
\>[0]\AgdaComment{-- returns true if the woman prefers m over h}\<%
\\
\>[0]\AgdaFunction{propose}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)(}\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Bool}\<%
\\
\>[0]\AgdaComment{-- Woman compares}\<%
\\
\>[0]\AgdaFunction{propose}%
\>[275I]\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{preferenceList}\AgdaSpace{}%
\AgdaKeyword{with}\<%
\\
\>[.][@{}l@{}]\<[275I]%
\>[8]\AgdaFunction{positionInList}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{preferenceList}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaFunction{positionInList}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{preferenceList}\<%
\\
\>[0]\AgdaComment{--does she prefer the new guy to the current one?}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{p}%
\>[14]\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{q}%
\>[24]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{is-≤}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
\>[0]\AgdaComment{--shouldn't happen in an ideal world : woman received a proposal from an unknown man??}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{p}%
\>[14]\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{false}\<%
\\
\>[0]\AgdaComment{--shouldn't happen in an ideal world : woman married an unknown man previously??}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{q}%
\>[24]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{false}\<%
\\
\>[0]\AgdaComment{--shouldn't happen in an ideal world : who are these men??}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{false}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- We assume the "husbands" to be the proposing side,}\<%
\\
\>[0]\AgdaComment{-- therefore if women propose the pair looks like (wife, husband)}\<%
\\
\>[0]\AgdaFunction{getHusband}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaComment{--not married yet and this is the first proposal in the algorithm!}\<%
\\
\>[0]\AgdaFunction{getHusband}\AgdaSpace{}%
\AgdaBound{woman}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\<%
\\
\>[0]\AgdaFunction{getHusband}\AgdaSpace{}%
\AgdaBound{woman}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{woman}\AgdaSpace{}%
\AgdaBound{w}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaComment{--found your husband!}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\AgdaSpace{}%
\AgdaComment{--not married yet}\<%
\\
\>[0]\AgdaFunction{getHusband}\AgdaSpace{}%
\AgdaBound{woman}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{cs}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{woman}\AgdaSpace{}%
\AgdaBound{w}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaComment{--found your husband!}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{getHusband}\AgdaSpace{}%
\AgdaBound{woman}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{cs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaComment{--keep searching}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{getWife}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaFunction{getWife}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\<%
\\
\>[0]\AgdaFunction{getWife}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaComment{--found your wife!}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\AgdaSpace{}%
\AgdaComment{--not married yet}\<%
\\
\>[0]\AgdaFunction{getWife}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{cs}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaComment{--found your wife!}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{getHusband}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{cs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaComment{--keep searching}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Simply extract a preference list from the scheme of indexed lists.}\<%
\\
\>[0]\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaBound{person}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaComment{--dummy case}\<%
\\
\>[0]\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaBound{person}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{preferences}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ps}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{person}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{preferences}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaBound{person}\AgdaSpace{}%
\AgdaBound{ps}\<%
\\
\>[0]\<%
\end{code}

In case the woman was previously married, it is important that the new couple "overwrites" the previous couple in which the woman was featured, therefore we simply introduce a "safe" operation for the list update:

\begin{code}%
\>[0]\AgdaComment{-- Safely adding couples : previous marriages are unmade}\<%
\\
\>[0]\AgdaFunction{safeAddNewCouple}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newCouple}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)(}\AgdaBound{previousCouples}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{safeAddNewCouple}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
\>[0]\AgdaFunction{safeAddNewCouple}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
\>[0]\AgdaFunction{safeAddNewCouple}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{cs}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{cs}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaFunction{safeAddNewCouple}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{cs}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{p}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{l}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{safeAddNewCouple}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{p}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
\>[0]\AgdaFunction{p}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaBound{w}\<%
\\
\>[0]\AgdaFunction{p}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaBound{w}\<%
\\
\>[0]\AgdaFunction{p}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaBound{w}\<%
\\
\>[0]\AgdaFunction{p}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaFunction{p}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{))))}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaBound{w}\<%
\\
\>[0]\AgdaFunction{p}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
\>[0]\AgdaFunction{p}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\end{code}

Similarly, when the list of engaged men is updated, the previous husband must be removed from it:

\begin{code}%
\>[0]\AgdaComment{-- Safely adding new engaged men to the list : dumped man is removed}\<%
\\
\>[0]\AgdaFunction{safeAddNewEngagedMan}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newEngagedMan}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))(}\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)(}\AgdaBound{prevEngagedMen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaComment{-- Dummy case: this function is only invoked if a woman is already married, so the list of engaged men can not possibly be empty...}\<%
\\
\>[0]\AgdaFunction{safeAddNewEngagedMan}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{safeAddNewEngagedMan}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaComment{--kick him out!}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaComment{--safe to keep after all}\<%
\\
\>[0]\AgdaFunction{safeAddNewEngagedMan}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaComment{--kick him out!}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaFunction{safeAddNewEngagedMan}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaComment{--safe to keep... for now}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- We give an alternative version which doesn't lose information:}\<%
\\
\>[0]\AgdaComment{-- it also returns the dumped man in a pair, or a dummy man}\<%
\\
\>[0]\AgdaComment{-- with an empty list. This helps Agda keep track of the length}\<%
\\
\>[0]\AgdaComment{-- of the preference lists in the matching state}\<%
\\
\>[0]\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newEngagedMan}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))(}\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)(}\AgdaBound{prevEngagedMen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaComment{-- Dummy case: this function is only invoked if a woman is already married, so the list of engaged men can not possibly be empty...}\<%
\\
\>[0]\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaComment{--kick him out!}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(((}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaComment{--safe to keep after all}\<%
\\
\>[0]\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaComment{--kick him out!}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{newFiance}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{prevFiance}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaComment{--safe to keep... for now}\<%
\\
\>[0]\<%
\end{code}

Finally, we implement a step of the Gale-Shapley algorithm by pattern matching on the matching state. There are two main cases to be distinguished:

\begin{itemize}
    \item there is still a free man with a woman to propose to on his list: we make the proposal, update the state accordingly and return the matching;
    \item there are no more free men: we return the current state as the final (and stable) matching state.
\end{itemize}

We detail them further in the comments:

\begin{code}%
\>[0]\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{MatchingState}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{MatchingState}\<%
\\
\>[0]\AgdaComment{-- When there are no more free men, the matching is stable and this is the last step.}\<%
\\
\>[0]\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Dummy case : the function shouldn't really be invoked with a man with empty preferences.}\<%
\\
\>[0]\AgdaComment{-- But otherwise Agda would question the completeness of our pattern matching.}\<%
\\
\>[0]\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Proposal step}\<%
\\
\>[0]\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{getHusband}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaBound{couples}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{propose}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaBound{women}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaComment{--Woman has a husband, represented by his literal number}\<%
\\
\>[0]\AgdaSymbol{...}%
\>[18]\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{true}%
\>[26]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaFunction{freeMenUpdated}\AgdaSpace{}%
\AgdaFunction{engagedMenUpdated}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{safeAddNewCouple}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{compSumPrefLists}\AgdaSpace{}%
\AgdaFunction{freeMenUpdated}\AgdaSpace{}%
\AgdaFunction{engagedMenUpdated}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[26][@{}l@{\AgdaIndent{0}}]%
\>[27]\AgdaKeyword{where}\<%
\\
\>[27][@{}l@{\AgdaIndent{0}}]%
\>[31]\AgdaFunction{freeMenUpdated}%
\>[49]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\<%
\\
%
\>[31]\AgdaFunction{engagedMenUpdated}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaSymbol{...}%
\>[18]\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{false}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{compSumPrefLists}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaComment{-- Woman didn't have a husband yet (represented by zero) : must accept proposal}\<%
\\
\>[0]\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}%
\>[87]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}%
\>[1048I]\AgdaBound{men}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{safeAddNewCouple}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSymbol{)}\<%
\\
\>[1048I][@{}l@{\AgdaIndent{0}}]%
\>[99]\AgdaSymbol{(}\AgdaFunction{compSumPrefLists}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{+-zero}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
\>[0]\AgdaFunction{+-zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{+-zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{+-zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
\>[0]\AgdaFunction{+-zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaBound{n}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{0}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{+-right-identity}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{+-move-zero}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\<%
\\
\>[0]\AgdaFunction{+-move-zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaFunction{+-move-zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
\>[0]\AgdaFunction{+-move-zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
\>[0]\AgdaFunction{+-move-zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaBound{n}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{0}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{+-move-zero}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{n≤n+m}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaFunction{n≤n+m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-refl}\<%
\\
\>[0]\AgdaFunction{n≤n+m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[22]\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-reflexive}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{cong}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{+-right-identity}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{))))}\<%
\\
\>[0]\AgdaFunction{n≤n+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤n+m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n≤n+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{s≤′s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤n+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{s}\<%
\\
\>[0]\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))(}\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{compSumPrefLists}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-reflexive}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-reflexive}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{+-zero}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{+-move-zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{≤-reflexive}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{+-zero}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{+-move-zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaFunction{lengthPrefs}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{freeMen}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{suc}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaFunction{lengthPrefs}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{((}}\AgdaDottedPattern{\AgdaBound{fst₁}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{snd₁}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{engagedMen}}\AgdaDottedPattern{\AgdaSymbol{)))}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤m+n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{))))}\<%
\\
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{suc}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaFunction{lengthPrefs}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{((}}\AgdaDottedPattern{\AgdaBound{fst}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{snd}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{freeMen}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaFunction{lengthPrefs}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{engagedMen}}\AgdaDottedPattern{\AgdaSymbol{))}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n+m≤n+m+s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{cong}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{lengthPrefsOneSide}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{n≤n+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤m+n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{stepsWithPrefs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
\>[0]\AgdaFunction{stepsWithPrefs}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{stepsWithPrefs}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{stepsWithPrefs}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
\>[0]\AgdaFunction{stepsWithPrefs}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaBound{p₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{stepsWithPrefs}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{p₁}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{r}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{s≤′s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaBound{r}\<%
\\
\>[0]\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{s≤′s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{lengthPrefsExtLemma}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)(}\AgdaBound{xs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))(}\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{xs}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lengthPrefsExtLemma}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{lengthPrefsExtLemma}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{n≤′m+n}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lengthPrefsExtLemma}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{lengthPrefsExtLemma}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
\>[0]\AgdaFunction{lengthPrefsExtLemma}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ws}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{n≤′m+n}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ws}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaFunction{lengthPrefsExtLemma}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ws}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{m≤n+r+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{ws}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{n≤1+n-plus-zero}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n≤1+n-plus-zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{n≤1+n-plus-zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤1+n-plus-zero}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{n-plus-zero≤1+n+m}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n-plus-zero≤1+n+m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{n-plus-zero≤1+n+m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n-plus-zero≤1+n+m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n-plus-zero≤1+n+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{n-plus-zero≤1+n+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n-plus-zero≤1+n+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{n≤2+m+n}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n≤2+m+n}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{≤′-step}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n≤2+m+n}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{≤′-step}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n≤2+m+n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤2+m+n}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{n≤2+m+n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤2+m+n}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{z≤′n}\<%
\\
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤1+n}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\<%
\\
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{n≤2+m+n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{foldr}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n-plus-zero≤1+n+m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₂}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₂}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\<%
\\
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₂}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\<%
\\
\>[0]\AgdaFunction{freeMen+nLemma}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₂}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[2113I]\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))(}\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)(}\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[.][@{}l@{}]\<[2113I]%
\>[19]\AgdaFunction{length}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{))}\<%
\\
%
\>[19]\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{subst}%
\>[2165I]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[2165I][@{}l@{\AgdaIndent{0}}]%
\>[61]\AgdaSymbol{(}\AgdaFunction{solve}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{))}\<%
\\
%
\>[61]\AgdaSymbol{(}\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤1+n}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}))}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{suc}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaBound{formerHusband}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{k}}\AgdaDottedPattern{\AgdaSymbol{))}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{less}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{formerHusband}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{subst}%
\>[2234I]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[2234I][@{}l@{\AgdaIndent{0}}]%
\>[127]\AgdaSymbol{(}\AgdaFunction{solve}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{z}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{z}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{))}\<%
\\
%
\>[127]\AgdaSymbol{(}\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤1+n}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}))}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{subst}%
\>[2296I]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[2296I][@{}l@{\AgdaIndent{0}}]%
\>[78]\AgdaSymbol{(}\AgdaFunction{solve}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{z}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{))}\<%
\\
%
\>[78]\AgdaSymbol{(}\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤1+n}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}))}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{suc}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{k}}\AgdaDottedPattern{\AgdaSymbol{))}}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{greater}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{subst}%
\>[2362I]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[2362I][@{}l@{\AgdaIndent{0}}]%
\>[94]\AgdaSymbol{(}\AgdaFunction{solve}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{z}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{z}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaInductiveConstructor{con}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{))}\<%
\\
%
\>[94]\AgdaSymbol{(}\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤1+n}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}))}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{compare}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{suc}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaBound{formerHusband}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{k}}\AgdaDottedPattern{\AgdaSymbol{))}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{less}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{formerHusband}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{suc}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaBound{formerHusband}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{k}}\AgdaDottedPattern{\AgdaSymbol{))}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{formerHusband}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{less}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{formerHusband}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaBound{updatedEngagedMen}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{extraInfo}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{equal}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{subst}%
\>[2492I]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[2492I][@{}l@{\AgdaIndent{0}}]%
\>[91]\AgdaSymbol{(}\AgdaFunction{solve}\AgdaSpace{}%
\AgdaNumber{5}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{z}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{z}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}%
\>[273]\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{))}\<%
\\
%
\>[91]\AgdaSymbol{(}\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤1+n}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}))}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{suc}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{k}}\AgdaDottedPattern{\AgdaSymbol{))}}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{greater}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{safeAddNewEngagedMan′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lemmaProposeTrue}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ms}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{suc}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaPrimitive{+}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{k}}\AgdaDottedPattern{\AgdaSymbol{))}}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{greater}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaBound{m}}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaBound{updatedEngagedMen}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{extraInfo}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{decompLemma}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{x₁}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{decompLemma}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{x₁}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{n≤1+n}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaFunction{decompLemma}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{decompLemma}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{decompLemma}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{decompLemma}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{singleWomanLemma}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\<%
\\
%
\>[2]\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{singleWomanLemma}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[2710I]\AgdaFunction{subst}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤′}}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[2710I][@{}l@{\AgdaIndent{0}}]%
\>[48]\AgdaSymbol{(}\AgdaFunction{solve}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{z}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:+}}\AgdaSpace{}%
\AgdaBound{z}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lengthPrefs}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{))}\<%
\\
%
\>[48]\AgdaSymbol{(}\AgdaFunction{≤⇒≤′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{n≤1+n}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{stepDec}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{MatchingState}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{MatchingState.sumPrefLists}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≥′}}\AgdaSpace{}%
\AgdaField{MatchingState.sumPrefLists}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{stepDec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-refl}\<%
\\
\>[0]\AgdaFunction{stepDec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-refl}\<%
\\
\>[0]\AgdaFunction{stepDec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{≤′-refl}\<%
\\
\>[0]\AgdaFunction{stepDec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{man}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{getHusband}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaBound{couples}\<%
\\
\>[0]\AgdaSymbol{...}%
\>[16]\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{propose}\AgdaSpace{}%
\AgdaBound{man}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaBound{women}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaSymbol{...}%
\>[16]\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{true}%
\>[24]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\AgdaSpace{}%
\AgdaComment{--lemmaProposeTrue freeMen engagedMen h man prefs }\<%
\\
\>[0]\AgdaSymbol{...}%
\>[16]\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{false}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\AgdaSpace{}%
\AgdaComment{--≤⇒≤′ (n≤1+n \AgdaUnderscore{})}\<%
\\
\>[0]\AgdaFunction{stepDec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{prefs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{nothing}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\AgdaSpace{}%
\AgdaComment{--singleWomanLemma freeMen n prefs engagedMen}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{TERMINATING}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\\
\>[0]\AgdaFunction{allSteps}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{MatchingState}\AgdaSymbol{)(}\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{compSumPrefLists}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.freeMen}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.engagedMen}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{MatchingState}\<%
\\
\>[0]\AgdaFunction{allSteps}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{step}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k₁}\AgdaSpace{}%
\AgdaBound{p₁}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k₁}\AgdaSpace{}%
\AgdaBound{p₁}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaBound{m'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{allSteps}\AgdaSpace{}%
\AgdaBound{m'}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{compSumPrefLists}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.freeMen}\AgdaSpace{}%
\AgdaBound{m'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.engagedMen}\AgdaSpace{}%
\AgdaBound{m'}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- List of preferences of men and women from the Gale-Shapley canonical example}\<%
\\
\>[0]\AgdaFunction{listMen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{listMen}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{listWomen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{listWomen}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Extra example : men and women have only one possible stable set of marriages! What could happen...?}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{listDifficultMen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{listDifficultMen}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{listDifficultWomen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{listDifficultWomen}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Proofs! :D}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- The type of elements that belong to a list.}\<%
\\
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}∈\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSymbol{\}(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{now}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{as}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{as}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{a'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{as}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaBound{as}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{as}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Bigger than comparison for Maybe ℕ-typed elements. }\<%
\\
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}>just\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{>}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{>just}}\AgdaSpace{}%
\AgdaInductiveConstructor{just}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Helper for the condition of stability: a person is better than another one}\<%
\\
\>[0]\AgdaComment{-- in a preference list if it appears earlier in it.}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≻[\AgdaUnderscore{}]\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaBound{person}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≻[}}\AgdaSpace{}%
\AgdaBound{list}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{person₂}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{positionInList}\AgdaSpace{}%
\AgdaBound{person₂}\AgdaSpace{}%
\AgdaBound{list}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{>just}}\AgdaSpace{}%
\AgdaFunction{positionInList}\AgdaSpace{}%
\AgdaBound{person}\AgdaSpace{}%
\AgdaBound{list}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Given a man and a woman and their preferences, the condition of stability is satisfied if}\<%
\\
\>[0]\AgdaComment{-- another m' and w' are not better positioned in their preference lists than their partners.}\<%
\\
\>[0]\AgdaFunction{conditionOfStabilitySatisfied}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))(}\AgdaBound{c₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{conditionOfStabilitySatisfied}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsW}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{m'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsM'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{w'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{prefsW'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{w'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≻[}}\AgdaSpace{}%
\AgdaBound{prefsM}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}%
\>[31]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≻[}}\AgdaSpace{}%
\AgdaBound{prefsW'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{m'}\AgdaSpace{}%
\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≻[}}\AgdaSpace{}%
\AgdaBound{prefsM'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{w'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≻[}}\AgdaSpace{}%
\AgdaBound{prefsW}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- A matching is stable if the condition of stability is satisfied for every pair of man and woman not married.}\<%
\\
\>[0]\AgdaFunction{is-stable-matching}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{MatchingState}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{is-stable-matching}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{(}\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{(}\AgdaBound{c₁}%
\>[3283I]\AgdaBound{c₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[.][@{}l@{}]\<[3283I]%
\>[10]\AgdaFunction{conditionOfStabilitySatisfied}\<%
\\
\>[10][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{men}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{women}\AgdaSymbol{))}\<%
\\
%
\>[12]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{men}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{women}\AgdaSymbol{)))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{exStart}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSpace{}%
\AgdaFunction{exEndExpected}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{MatchingState}\<%
\\
\>[0]\AgdaFunction{exStart}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaFunction{listMen}\AgdaSpace{}%
\AgdaFunction{listMen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaFunction{listWomen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaNumber{9}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaComment{-- Gale and Shapley tell us that, for the first simple example, each men gets his first woman from the list as a wife}\<%
\\
\>[0]\AgdaComment{-- and there are no conflicts among them. So we expect the following end state:}\<%
\\
\>[0]\AgdaFunction{exEndExpected}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaFunction{listMen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{))}\AgdaSpace{}%
\AgdaFunction{listWomen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaNumber{6}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaFunction{exEnd}%
\>[14]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaFunction{exStart}\AgdaSymbol{)))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{resultIsWhatWeExpected}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{exEndExpected}\<%
\\
\>[0]\AgdaFunction{resultIsWhatWeExpected}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{ex2Start}\AgdaSpace{}%
\AgdaFunction{ex2End}\AgdaSpace{}%
\AgdaFunction{ex2EndExpected}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{MatchingState}\<%
\\
\>[0]\AgdaFunction{ex2Start}%
\>[17]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaFunction{listDifficultMen}\AgdaSpace{}%
\AgdaFunction{listDifficultMen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaFunction{listDifficultWomen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaNumber{16}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaComment{-- A second, harder example is given where there is only one possible stable set of marriages.}\<%
\\
\>[0]\AgdaFunction{ex2EndExpected}%
\>[17]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaFunction{listDifficultMen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{listDifficultWomen}\AgdaSpace{}%
\AgdaSymbol{(((}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaNumber{7}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaFunction{ex2End}%
\>[17]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{step}\AgdaSpace{}%
\AgdaFunction{ex2Start}\AgdaSymbol{))))))))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{result2IsWhatWeExpected}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ex2End}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{ex2EndExpected}\<%
\\
\>[0]\AgdaFunction{result2IsWhatWeExpected}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- f : just 0 >just just 1 → ⊥}\<%
\\
\>[0]\AgdaComment{-- f (\AgdaUnderscore{}from>\AgdaUnderscore{} ())}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c₁}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}%
\>[39]\AgdaSymbol{→}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaBound{c₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaField{MatchingState.couples}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
%
\>[6]\AgdaBound{c₂}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaField{MatchingState.couples}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[7]\AgdaFunction{conditionOfStabilitySatisfied}\<%
\\
%
\>[6]\AgdaSymbol{(((}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.men}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.women}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSymbol{))))}\<%
\\
%
\>[6]\AgdaSymbol{(((}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.men}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.women}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSymbol{))))}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\<%
\\
\>[0]\AgdaFunction{matchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}%
\>[52]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{matchIsStable}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{is-stable-matching}\AgdaSpace{}%
\AgdaFunction{exEnd}\<%
\\
\>[0]\AgdaFunction{matchIsStable}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{matchIsStableHelper}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- In order to define that a matching m₁ is better than a matching m₂,}\<%
\\
\>[0]\AgdaComment{-- we take into consideration that for all men they get a better (earlier in their list) wife}\<%
\\
\>[0]\AgdaComment{-- in m₁ than in m₂; this can be seen from the size of his preference list in the final}\<%
\\
\>[0]\AgdaComment{-- state of the matching. }\<%
\\
\>[0]\AgdaFunction{is-better-matching}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m₁}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{MatchingState}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{is-better-matching}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men₁}\AgdaSpace{}%
\AgdaBound{freeMen₁}\AgdaSpace{}%
\AgdaBound{engagedMen₁}\AgdaSpace{}%
\AgdaBound{women₁}\AgdaSpace{}%
\AgdaBound{couples₁}\AgdaSpace{}%
\AgdaBound{k₁}\AgdaSpace{}%
\AgdaBound{p₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{is-stable-matching}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaFunction{is-stable-matching}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men₁}\AgdaSpace{}%
\AgdaBound{freeMen₁}\AgdaSpace{}%
\AgdaBound{engagedMen₁}\AgdaSpace{}%
\AgdaBound{women₁}\AgdaSpace{}%
\AgdaBound{couples₁}\AgdaSpace{}%
\AgdaBound{k₁}\AgdaSpace{}%
\AgdaBound{p₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaSymbol{((}\AgdaBound{m₁}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSpace{}%
\AgdaSymbol{→}%
\>[46]\AgdaBound{m₂}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaBound{engagedMen₁}%
\>[64]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[3][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{men₁}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
%
\>[4]\AgdaFunction{length}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≥}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Let us demonstrate with the first canonical example. Gale and Shapley tell us}\<%
\\
\>[0]\AgdaComment{-- that another possible stable marriage (not returned by their algorithm) is obtained}\<%
\\
\>[0]\AgdaComment{-- by giving every woman her first choice:}\<%
\\
\>[0]\AgdaFunction{anotherPossibleStableMatching}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{MatchingState}\<%
\\
\>[0]\AgdaFunction{anotherPossibleStableMatching}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaFunction{listMen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{listWomen}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c₁}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaBound{c₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaField{MatchingState.couples}\AgdaSpace{}%
\AgdaFunction{anotherPossibleStableMatching}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
%
\>[6]\AgdaBound{c₂}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaField{MatchingState.couples}\AgdaSpace{}%
\AgdaFunction{anotherPossibleStableMatching}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
%
\>[6]\AgdaFunction{conditionOfStabilitySatisfied}\<%
\\
%
\>[6]\AgdaSymbol{(((}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.men}\AgdaSpace{}%
\AgdaFunction{anotherPossibleStableMatching}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.women}\AgdaSpace{}%
\AgdaFunction{anotherPossibleStableMatching}\AgdaSymbol{))))}\<%
\\
%
\>[6]\AgdaSymbol{(((}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.men}\AgdaSpace{}%
\AgdaFunction{anotherPossibleStableMatching}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.women}\AgdaSpace{}%
\AgdaFunction{anotherPossibleStableMatching}\AgdaSymbol{))))}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}from>\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
\>[0]\AgdaFunction{anotherMatchIsStableHelper}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaBound{c₂}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{itIsAlsoStable}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{is-stable-matching}\AgdaSpace{}%
\AgdaFunction{anotherPossibleStableMatching}\<%
\\
\>[0]\AgdaFunction{itIsAlsoStable}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{anotherMatchIsStableHelper}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m₁}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Σ}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaField{MatchingState.engagedMen}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∈}}\AgdaSpace{}%
\AgdaField{MatchingState.engagedMen}\AgdaSpace{}%
\AgdaFunction{anotherPossibleStableMatching}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{(}\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{listMen}\<%
\\
%
\>[6]\AgdaOperator{\AgdaDatatype{≡}}\<%
\\
%
\>[6]\AgdaFunction{getPreferenceList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₁}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{listMen}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{→}\<%
\\
%
\>[6]\AgdaFunction{length}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≥}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.((}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{1}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaNumber{3}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{∷}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaNumber{2}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaOperator{\AgdaInductiveConstructor{,}}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{now}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.}}\AgdaDottedPattern{\AgdaInductiveConstructor{[]}}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\<%
\\
\>[0]\AgdaFunction{matchIsBetterHelper}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{())))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{later}\AgdaSpace{}%
\AgdaBound{p₂}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{p₃}\AgdaSpace{}%
\AgdaBound{p₄}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{matchIsBetter}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{is-better-matching}\AgdaSpace{}%
\AgdaFunction{exEnd}\AgdaSpace{}%
\AgdaFunction{anotherPossibleStableMatching}\<%
\\
\>[0]\AgdaFunction{matchIsBetter}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{matchIsStable}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{itIsAlsoStable}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{matchIsBetterHelper}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{-- Given two stable matchings m₁ , m₂ where m₁ is the result of the computation of the Gale-Shapley algorithm,}\<%
\\
\>[0]\AgdaComment{-- }\<%
\\
\>[0]\AgdaFunction{anyMatchIsBetter}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}%
\>[4867I]\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{MatchingState}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{allSteps}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{compSumPrefLists}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.freeMen}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{MatchingState.engagedMen}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[.][@{}l@{}]\<[4867I]%
\>[21]\AgdaFunction{is-stable-matching}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{is-stable-matching}\AgdaSpace{}%
\AgdaBound{m₂}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
%
\>[21]\AgdaFunction{is-better-matching}\AgdaSpace{}%
\AgdaBound{m₁}\AgdaSpace{}%
\AgdaBound{m₂}\<%
\\
\>[0]\AgdaFunction{anyMatchIsBetter}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{sumPrefLists}\AgdaSpace{}%
\AgdaBound{sumEq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men₁}\AgdaSpace{}%
\AgdaBound{freeMen₁}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{women₁}\AgdaSpace{}%
\AgdaBound{couples₁}\AgdaSpace{}%
\AgdaBound{sumPrefLists₁}\AgdaSpace{}%
\AgdaBound{sumEq₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\<%
\\
\>[0]\AgdaFunction{anyMatchIsBetter}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{sumPrefLists}\AgdaSpace{}%
\AgdaBound{sumEq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men₁}\AgdaSpace{}%
\AgdaBound{freeMen₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{women₁}\AgdaSpace{}%
\AgdaBound{couples₁}\AgdaSpace{}%
\AgdaBound{sumPrefLists₁}\AgdaSpace{}%
\AgdaBound{sumEq₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\<%
\\
\>[0]\AgdaFunction{anyMatchIsBetter}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{sumPrefLists}\AgdaSpace{}%
\AgdaBound{sumEq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men₁}\AgdaSpace{}%
\AgdaBound{freeMen₁}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{women₁}\AgdaSpace{}%
\AgdaBound{couples₁}\AgdaSpace{}%
\AgdaBound{sumPrefLists₁}\AgdaSpace{}%
\AgdaBound{sumEq₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\<%
\\
\>[0]\AgdaFunction{anyMatchIsBetter}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men}\AgdaSpace{}%
\AgdaBound{freeMen}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{women}\AgdaSpace{}%
\AgdaBound{couples}\AgdaSpace{}%
\AgdaBound{sumPrefLists}\AgdaSpace{}%
\AgdaBound{sumEq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkState}\AgdaSpace{}%
\AgdaBound{men₁}\AgdaSpace{}%
\AgdaBound{freeMen₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{engagedMen₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{women₁}\AgdaSpace{}%
\AgdaBound{couples₁}\AgdaSpace{}%
\AgdaBound{sumPrefLists₁}\AgdaSpace{}%
\AgdaBound{sumEq₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fst₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{snd₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{!!\}}\AgdaSpace{}%
\AgdaComment{--(fst , snd) , (fst₁ , snd₁) , ?}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{\{-- this is for correctness:
-- stepInv : (m : MatchingState) → Inv m → Inv (step m)

Something like:

data GaleShapleyInv : (m : MatchingState) → Set where
  inv : m ∈ m.listMen → w ∈ m.listWomen → b ∉ l(a) → (∃ a′ ∈ m : a′ ≻\AgdaUnderscore{}\{b\} a ∨ p(a) = b
-\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{leftinv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
\>[0]\AgdaFunction{leftinv}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{rightinv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
\>[0]\AgdaFunction{rightinv}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaFunction{rightinv}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{cong}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{rightinv}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}}
